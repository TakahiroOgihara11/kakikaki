

<div class="user-show-page">
  <div class="content">

   <section class="user-hero">
     <div class="user-hero__top">
       <h1 class="user-hero__heading">
         <%= @user == current_user ? "マイページ" : "#{@user.name}さんのプロフィール" %>
       </h1>
       <% if current_user == @user %>  
         <p class="user-hero__sub">
           <% if @user.tweets.where(created_at: Time.zone.now.all_day).exists? %>
             今日は日記を書きました <%= image_tag "check_icon.svg", alt: "チェックマーク", class: "check-icon" %>
           <% else %>
             今日は日記を書きましたか？
           <% end %>
         </p>
       <% end %>
     </div>

     <% if current_user == @user %>  
       <div class="user-hero__actions">
         <%= link_to "日記を投稿する", new_tweet_path, class: "btn btn--primary" %>
         <% if @user.tweets.where(created_at: Time.zone.now.all_day).exists? %>
           <%= link_to "フォロー中の人の日記を見る", following_posts_tweets_path, class: "btn btn--ghost" %>
         <% else %>
           <span class="btn btn--disabled">フォロー中の人の日記を見る（本日未投稿）</span>
         <% end %>
         <%= link_to "ユーザー一覧", users_path, class: "btn btn--ghost" %>
         <%= link_to "編集する", edit_user_registration_path, class: "btn btn--ghost" %>
       </div>
     <% end %>
   </section>


    <section class="user-main">
      <aside>
        <div class="card">
          <div class="profile-card__header">
            <%= image_tag(@user.profile_image.attached? ? @user.profile_image : "default_icon.png",
                          class: "profile-card__avatar") %>
            <div>
              <h2 class="profile-card__name"><%= @user.name %></h2>
              <% if current_user == @user %>
                <p class="profile-card__email"><%= @user.email %></p>
              <% end %>
            </div>
          </div>
          <p class="profile-card__bio"><%= @user.profile %></p>
        </div>

        <% unless current_user == @user %>
          <div class="card" style="margin-top:12px">
            <h3 class="section-title">初めての日記</h3>
            <div class="recent-list">
              <% @user.tweets.order(created_at: :asc).limit(1).each do |tweet| %>
                <article class="recent-item">
                  <h4 class="recent-item__title"><%= tweet.name %></h4>
                  <p class="recent-item__meta"><%= tweet.created_at.strftime('%Y-%m-%d %H:%M') %></p>
                  <% if tweet.image.attached? %>
                    <%= image_tag tweet.image, class: "recent-item__img clickable-image", data: { full_image_url: url_for(tweet.image) } %>
                  <% end %>
                  <p>💗 <%= tweet.likes.count %>件のいいね</p>
                </article>
              <% end %>
            </div>
          </div>
        <% end %>
      </aside>

        <% if current_user == @user %>
            <section>
             <h3 class="section-title">あなたの投稿一覧</h3>
              <div class="timeline">
               <% @user.tweets.order(created_at: :desc).each do |t| %>
                  <article class="post">
                   <h4 class="post__title"><%= t.name %></h4>
                    <p class="post__meta"><%= t.time.strftime('%Y-%m-%d %H:%M') if t.time %></p>
                   <p><%= t.diary %></p>
                   <% if t.image.attached? %>
                      <%= image_tag t.image, class: "post__img clickable-image", data: { full_image_url: url_for(t.image) } %>
                    <% end %>
                    <p>💗 <%= t.likes.count %>件のいいね</p>
                  </article>
               <% end %>
              </div>
           </section>
        <% end %>

      </section>
    </section>

    <!-- 既存のモーダルはそのまま使う -->
    <div id="image-modal" class="modal"><img id="modal-image" src=""></div>

  </div>
</div>




